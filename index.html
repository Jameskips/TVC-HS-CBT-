<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TVC High School — CBT (JSONBin)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .card { border: 1px solid #ccc; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
    .row { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
    th { background: #f0f0f0; }
    button { padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; }
    button.muted { background: #ddd; }
    button.danger { background: #e74c3c; color: #fff; }
    button.small { font-size: 12px; padding: 2px 6px; }
    input, select { padding: 4px; }
    .muted { color: #555; }
  </style>
</head>
<body>
  <header><h1>The Valued Child (TVC) High School — CBT</h1></header>
  <div class="wrap">

    <!-- LOGIN -->
    <div id="loginCard" class="card">
      <h2>Login</h2>
      <input id="loginUser" placeholder="Username" />
      <input id="loginClass" placeholder="Class (e.g. JSS1)" />
      <input id="loginPass" type="password" placeholder="Password" />
      <button id="btnLogin">Login</button>
      <p id="loginMsg" class="muted"></p>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="adminCard" class="card hidden">
      <div class="row" style="justify-content:space-between">
        <h2>Admin Dashboard</h2>
        <button id="btnLogoutAdmin" class="muted">Logout</button>
      </div>

      <!-- SUBJECTS -->
      <div class="card">
        <h3>Subjects</h3>
        <div class="row">
          <input id="newSubjectInput" placeholder="New subject name" />
          <input id="newSubjectClassInput" placeholder="Class (e.g. JSS1)" />
          <button id="btnAddSubject">Add</button>
        </div>
        <table>
          <thead><tr><th>Subject</th><th>Class</th><th>Actions</th></tr></thead>
          <tbody id="subjectsTbody"></tbody>
        </table>
      </div>

      <!-- QUESTIONS -->
      <div class="card">
        <h3>Questions</h3>
        <div class="row">
          <select id="questionSubjectSelect"></select>
        </div>
        <div class="row">
          <input id="questionText" placeholder="Question text" style="flex:1" />
        </div>
        <div class="row">
          <input id="optionA" placeholder="Option A" />
          <input id="optionB" placeholder="Option B" />
          <input id="optionC" placeholder="Option C" />
        </div>
        <div class="row">
          <label>Correct:</label>
          <select id="correctOption">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
          </select>
          <button id="btnAddQuestion">Add Question</button>
        </div>
        <table>
          <thead><tr><th>Question</th><th>Subject</th><th>Correct</th><th>Actions</th></tr></thead>
          <tbody id="questionsTbody"></tbody>
        </table>
      </div>

      <!-- STUDENTS -->
      <div class="card">
        <h3>Students</h3>
        <div class="row">
          <input id="stuUsername" placeholder="Username" />
          <input id="stuFullName" placeholder="Full name" />
          <input id="stuClass" placeholder="Class (e.g. JSS1)" />
          <input id="stuPassword" placeholder="Password" />
          <button id="btnAddStudent">Add</button>
        </div>
        <table>
          <thead><tr><th>Username</th><th>Name</th><th>Class</th><th>Actions</th></tr></thead>
          <tbody id="studentsTbody"></tbody>
        </table>
      </div>

      <!-- RESULTS -->
      <div class="card">
        <h3>Results</h3>
        <button id="btnExportResults" class="muted">Export Results CSV</button>
        <table>
          <thead id="resultsThead"></thead>
          <tbody id="resultsTbody"></tbody>
        </table>
      </div>
    </div>

    <!-- STUDENT DASHBOARD -->
    <div id="studentCard" class="card hidden">
      <h2 id="studentHeader">Student Panel</h2>
      <div id="studentSubjects"></div>
      <button id="btnLogoutStudent" class="muted">Logout</button>
    </div>
  </div>

<script>
/* ============================
   DATABASE
============================ */
let db = {
  subjects: [],
  questions: [],
  students: [],
  scores: []
};
let currentUser = null;

/* ============================
   LOGIN
============================ */
btnLogin.onclick = () => {
  const username = loginUser.value.trim();
  const password = loginPass.value.trim();
  const cls = loginClass.value.trim();

  if (username === "admin" && password === "admin") {
    loginCard.classList.add("hidden");
    adminCard.classList.remove("hidden");
    renderSubjects(); renderQuestions(); renderStudents(); renderResults();
    currentUser = { role: "admin" };
    return;
  }

  const student = db.students.find(s=>s.username===username && s.class===cls && s.password===password);
  if (student) {
    loginCard.classList.add("hidden");
    studentCard.classList.remove("hidden");
    studentHeader.textContent = "Student Panel — " + student.name + " (" + student.class + ")";
    currentUser = { role:"student", ...student };
    renderStudentSubjects();
    return;
  }

  loginMsg.textContent = "Invalid login";
};

btnLogoutAdmin.onclick = () => { adminCard.classList.add("hidden"); loginCard.classList.remove("hidden"); };
btnLogoutStudent.onclick = () => { studentCard.classList.add("hidden"); loginCard.classList.remove("hidden"); };

/* ============================
   SUBJECTS CRUD
============================ */
btnAddSubject.onclick = () => {
  const name=newSubjectInput.value.trim(), cls=newSubjectClassInput.value.trim();
  if(!name||!cls) return alert("Enter subject & class");
  db.subjects.push({id:Date.now(),name, class:cls});
  newSubjectInput.value=newSubjectClassInput.value="";
  renderSubjects(); renderQuestionSubjects();
};
function renderSubjects(){
  subjectsTbody.innerHTML="";
  db.subjects.forEach(s=>{
    subjectsTbody.innerHTML+=`<tr><td>${s.name}</td><td>${s.class}</td>
      <td><button class="small" onclick="editSubject(${s.id})">Edit</button>
      <button class="small danger" onclick="deleteSubject(${s.id})">Delete</button></td></tr>`;
  });
  renderQuestionSubjects();
}
function editSubject(id){
  const s=db.subjects.find(x=>x.id===id);
  const newName=prompt("Edit subject name:",s.name);
  const newClass=prompt("Edit class:",s.class);
  if(newName&&newClass){ s.name=newName; s.class=newClass; renderSubjects(); }
}
function deleteSubject(id){ db.subjects=db.subjects.filter(s=>s.id!==id); renderSubjects(); }

/* ============================
   QUESTIONS CRUD
============================ */
btnAddQuestion.onclick = () => {
  const subId=parseInt(questionSubjectSelect.value);
  const text=questionText.value.trim();
  if(!subId||!text) return alert("Enter question & select subject");
  db.questions.push({
    id:Date.now(), subjectId:subId, question:text,
    A:optionA.value, B:optionB.value, C:optionC.value,
    correct:correctOption.value
  });
  questionText.value=optionA.value=optionB.value=optionC.value="";
  renderQuestions();
};
function renderQuestionSubjects(){
  questionSubjectSelect.innerHTML="";
  db.subjects.forEach(s=>{
    questionSubjectSelect.innerHTML+=`<option value="${s.id}">${s.name} (${s.class})</option>`;
  });
}
function renderQuestions(){
  questionsTbody.innerHTML="";
  db.questions.forEach(q=>{
    const subj=db.subjects.find(s=>s.id===q.subjectId);
    questionsTbody.innerHTML+=`<tr><td>${q.question}</td><td>${subj?subj.name+" ("+subj.class+")":""}</td>
      <td>${q.correct}</td>
      <td><button class="small" onclick="editQuestion(${q.id})">Edit</button>
      <button class="small danger" onclick="deleteQuestion(${q.id})">Delete</button></td></tr>`;
  });
}
function editQuestion(id){
  const q=db.questions.find(x=>x.id===id);
  const newQ=prompt("Edit question:",q.question);
  if(newQ) q.question=newQ;
  renderQuestions();
}
function deleteQuestion(id){ db.questions=db.questions.filter(q=>q.id!==id); renderQuestions(); }

/* ============================
   STUDENTS CRUD
============================ */
btnAddStudent.onclick = () => {
  db.students.push({id:Date.now(),username:stuUsername.value,name:stuFullName.value,class:stuClass.value,password:stuPassword.value});
  stuUsername.value=stuFullName.value=stuClass.value=stuPassword.value="";
  renderStudents();
};
function renderStudents(){
  studentsTbody.innerHTML="";
  db.students.forEach(s=>{
    studentsTbody.innerHTML+=`<tr><td>${s.username}</td><td>${s.name}</td><td>${s.class}</td>
      <td><button class="small" onclick="editStudent(${s.id})">Edit</button>
      <button class="small danger" onclick="deleteStudent(${s.id})">Delete</button></td></tr>`;
  });
}
function editStudent(id){
  const s=db.students.find(x=>x.id===id);
  const newName=prompt("Edit name:",s.name);
  if(newName) s.name=newName;
  renderStudents();
}
function deleteStudent(id){ db.students=db.students.filter(s=>s.id!==id); renderStudents(); }

/* ============================
   RESULTS
============================ */
function renderResults(){
  resultsThead.innerHTML="<tr><th>No results yet</th></tr>";
  resultsTbody.innerHTML="";
}
btnExportResults.onclick=()=>alert("CSV export coming soon");

/* ============================
   STUDENT PANEL
============================ */
function renderStudentSubjects(){
  const subs=db.subjects.filter(s=>s.class===currentUser.class);
  studentSubjects.innerHTML="<h3>Your Subjects:</h3>";
  subs.forEach(s=>{
    studentSubjects.innerHTML+=`<div>${s.name}</div>`;
  });
}
</script>
</body>
</html>
