<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TVC High School CBT</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; text-align:center; padding:30px; }
    #loginBox, #adminDashboard, #studentDashboard { 
      background:#fff; padding:20px; border-radius:10px; width:400px; margin:auto; display:none; 
    }
    input, select { width:90%; padding:10px; margin:5px; }
    button { padding:10px; width:95%; background:#007bff; color:#fff; border:none; border-radius:5px; margin-top:10px; cursor:pointer; }
    button:hover { background:#0056b3; }
    h1 { margin-bottom:20px; }
    .list-item { border:1px solid #ddd; margin:5px; padding:8px; border-radius:5px; background:#fafafa; }
  </style>
</head>
<body>

  <h1>The Valued Child (TVC) High School - CBT</h1>
  
  <!-- Login Section -->
  <div id="loginBox" style="display:block;">
    <h3>Login</h3>
    <input type="text" id="username" placeholder="Enter username"><br>
    <input type="password" id="password" placeholder="Enter password"><br>
    <button onclick="login()">Login</button>
    <p id="errorMsg" style="color:red;"></p>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard">
    <h2>Admin Dashboard</h2>
    <button onclick="showSubjects()">üìò Manage Subjects</button>
    <button onclick="showQuestions()">üìù Manage Questions</button>
    <button onclick="showScores()">üìä View Scores</button>
    <br><br>
    <button onclick="logout()">Logout</button>
    <div id="adminContent"></div>
  </div>

  <!-- Student Dashboard -->
  <div id="studentDashboard">
    <h2>Student Dashboard</h2>
    <p>Select a subject to start exam:</p>
    <div id="subjectList"></div>
    <br>
    <button onclick="logout()">Logout</button>
    <div id="examArea"></div>
  </div>

  <script>
    // === CONFIG (Replace with your JSONBin details) ===
    const BIN_ID = "YOUR_BIN_ID";
    const API_KEY = "YOUR_API_KEY";
    const JSONBIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    
    // Local store (used before saving to JSONBin)
    let subjects = ["Mathematics", "English"];
    let questions = {
      "Mathematics": [
        { q: "2 + 2 = ?", options: ["3", "4", "5"], answer: "4" }
      ],
      "English": [
        { q: "Opposite of 'Hot'?", options: ["Warm", "Cold", "Cool"], answer: "Cold" }
      ]
    };
    let scores = [];

    // Default accounts
    const users = {
      "admin": "admin123",   // admin login
      "student": "student123" // student login
    };

    function login() {
      const uname = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      const errorMsg = document.getElementById("errorMsg");

      if (users[uname] && users[uname] === pass) {
        document.getElementById("loginBox").style.display = "none";

        if (uname === "admin") {
          document.getElementById("adminDashboard").style.display = "block";
        } else {
          document.getElementById("studentDashboard").style.display = "block";
          loadSubjects();
        }
      } else {
        errorMsg.innerText = "Invalid username or password!";
      }
    }

    function logout() {
      document.getElementById("adminDashboard").style.display = "none";
      document.getElementById("studentDashboard").style.display = "none";
      document.getElementById("loginBox").style.display = "block";
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }

    // === Admin Features ===
    function showSubjects() {
      let html = "<h3>üìò Subjects</h3>";
      html += `<input type="text" id="newSubject" placeholder="New subject"><button onclick="addSubject()">Add</button><br>`;
      subjects.forEach((s,i) => {
        html += `<div class='list-item'>${s} 
          <button onclick="deleteSubject(${i})">Delete</button></div>`;
      });
      document.getElementById("adminContent").innerHTML = html;
    }

    function addSubject() {
      const sub = document.getElementById("newSubject").value.trim();
      if(sub && !subjects.includes(sub)) {
        subjects.push(sub);
        questions[sub] = [];
        showSubjects();
      }
    }

    function deleteSubject(index) {
      const sub = subjects[index];
      subjects.splice(index,1);
      delete questions[sub];
      showSubjects();
    }

    function showQuestions() {
      let html = "<h3>üìù Manage Questions</h3>";
      html += `<select id="subjectSelect">${subjects.map(s=>`<option>${s}</option>`)}</select><br>`;
      html += `<input type="text" id="newQ" placeholder="Enter question"><br>
               <input type="text" id="opt1" placeholder="Option 1"><br>
               <input type="text" id="opt2" placeholder="Option 2"><br>
               <input type="text" id="opt3" placeholder="Option 3"><br>
               <input type="text" id="ans" placeholder="Correct Answer"><br>
               <button onclick="addQuestion()">Add Question</button><br><br>`;
      for (let s of subjects) {
        html += `<h4>${s}</h4>`;
        (questions[s] || []).forEach((q, i) => {
          html += `<div class='list-item'>Q: ${q.q}<br>Options: ${q.options.join(", ")}<br>Answer: ${q.answer} 
          <button onclick="deleteQuestion('${s}', ${i})">Delete</button></div>`;
        });
      }
      document.getElementById("adminContent").innerHTML = html;
    }

    function addQuestion() {
      const sub = document.getElementById("subjectSelect").value;
      const q = document.getElementById("newQ").value.trim();
      const o1 = document.getElementById("opt1").value.trim();
      const o2 = document.getElementById("opt2").value.trim();
      const o3 = document.getElementById("opt3").value.trim();
      const ans = document.getElementById("ans").value.trim();
      if(q && ans) {
        questions[sub].push({ q:q, options:[o1,o2,o3], answer:ans });
        showQuestions();
      }
    }

    function deleteQuestion(sub,index) {
      questions[sub].splice(index,1);
      showQuestions();
    }

    function showScores() {
      let html = "<h3>üìä Scores</h3>";
      if(scores.length===0) { html += "<p>No scores yet</p>"; }
      else {
        scores.forEach(s => {
          html += `<div class='list-item'>${s.student} - ${s.subject}: ${s.score}%</div>`;
        });
      }
      document.getElementById("adminContent").innerHTML = html;
    }

    // === Student Features ===
    function loadSubjects() {
      let html = "";
      subjects.forEach(s => {
        html += `<button onclick='startExam("${s}")'>${s}</button><br>`;
      });
      document.getElementById("subjectList").innerHTML = html;
    }

    function startExam(subject) {
      let qList = questions[subject] || [];
      if(qList.length===0) {
        document.getElementById("examArea").innerHTML = "<p>No questions available.</p>";
        return;
      }
      let html = `<h3>${subject} Exam</h3>`;
      qList.forEach((q,i) => {
        html += `<div class='list-item'>
          <p>${i+1}. ${q.q}</p>`;
        q.options.forEach(opt => {
          html += `<label><input type='radio' name='q${i}' value='${opt}'> ${opt}</label><br>`;
        });
        html += "</div>";
      });
      html += `<p id="timer">Time Left: 60s</p>`;
      html += `<button onclick='submitExam("${subject}")'>Submit</button>`;
      document.getElementById("examArea").innerHTML = html;

      // start timer
      let timeLeft = 60;
      let timer = setInterval(()=>{
        timeLeft--;
        document.getElementById("timer").innerText = "Time Left: " + timeLeft + "s";
        if(timeLeft<=0) {
          clearInterval(timer);
          submitExam(subject);
        }
      },1000);
    }

    function submitExam(subject) {
      let qList = questions[subject];
      let correct=0;
      qList.forEach((q,i) => {
        let ans = document.querySelector(`input[name=q${i}]:checked`);
        if(ans && ans.value===q.answer) correct++;
      });
      let score = Math.round((correct/qList.length)*100);
      scores.push({student:"student", subject, score});
      document.getElementById("examArea").innerHTML = "<p>Exam submitted successfully!</p>";
    }

  </script>

</body>
</html>
