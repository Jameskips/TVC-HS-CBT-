<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TVC High School CBT</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f8f9fa; margin:0; padding:0; }
    header { background:#007bff; color:#fff; padding:15px; text-align:center; }
    #loginBox, #dashboard, #examArea, #adminPanel { max-width:700px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    input, select { width:95%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:5px; }
    button { padding:10px 15px; margin:5px; border:none; border-radius:5px; cursor:pointer; }
    button.primary { background:#007bff; color:#fff; }
    button.danger { background:#dc3545; color:#fff; }
    button.success { background:#28a745; color:#fff; }
    .hidden { display:none; }
    .question { margin-bottom:15px; padding:10px; border:1px solid #ddd; border-radius:8px; }
    .timer { font-weight:bold; color:#dc3545; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
  </style>
</head>
<body>
  <header>
    <h1>The Valued Child (TVC) High School - CBT</h1>
  </header>

  <!-- Login -->
  <div id="loginBox">
    <h3>Login</h3>
    <input type="text" id="username" placeholder="Enter username"><br>
    <input type="password" id="password" placeholder="Enter password"><br>
    <button class="primary" onclick="login()">Login</button>
    <p id="errorMsg" style="color:red;"></p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <h2>Welcome, <span id="userRole"></span></h2>
    <div id="studentDashboard" class="hidden">
      <h3>Select Subject</h3>
      <select id="subjectSelect"></select>
      <button class="success" onclick="startExam()">Start Exam</button>
    </div>
    <div id="adminDashboard" class="hidden">
      <button class="primary" onclick="showAdminPanel()">Manage Questions</button>
      <button class="success" onclick="showScores()">View Scores</button>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Exam Area -->
  <div id="examArea" class="hidden">
    <h3 id="examSubject"></h3>
    <p>Time Remaining: <span class="timer" id="timer"></span></p>
    <form id="examForm"></form>
    <button class="primary" onclick="submitExam()">Submit</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="hidden">
    <h3>Manage Subjects & Questions</h3>
    <select id="adminSubjectSelect"></select><br>
    <button class="success" onclick="addSubject()">Add Subject</button>
    <button class="danger" onclick="deleteSubject()">Delete Subject</button>
    <hr>
    <h4>Add/Edit Question</h4>
    <input type="text" id="questionText" placeholder="Enter question"><br>
    <input type="text" id="optA" placeholder="Option A"><br>
    <input type="text" id="optB" placeholder="Option B"><br>
    <input type="text" id="optC" placeholder="Option C"><br>
    <input type="text" id="optD" placeholder="Option D"><br>
    <input type="text" id="correct" placeholder="Correct Option (A/B/C/D)"><br>
    <button class="primary" onclick="addQuestion()">Save Question</button>
    <hr>
    <h4>Questions</h4>
    <div id="questionList"></div>
  </div>

  <!-- Scores -->
  <div id="scoreBoard" class="hidden">
    <h3>Student Scores</h3>
    <table>
      <thead><tr><th>Student</th><th>Subject</th><th>Score</th></tr></thead>
      <tbody id="scoreTable"></tbody>
    </table>
  </div>

<script>
  // Sample users
  const users = { "admin":"admin123", "student":"student123" };
  let subjects = JSON.parse(localStorage.getItem("subjects")) || { "Mathematics":[], "English":[] };
  let scores = JSON.parse(localStorage.getItem("scores")) || [];
  let currentUser = null, currentSubject = "", timer, timeLeft=0;

  function login(){
    let uname=document.getElementById("username").value.trim();
    let pass=document.getElementById("password").value.trim();
    if(users[uname] && users[uname]===pass){
      currentUser=uname;
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("userRole").innerText=uname;
      if(uname==="admin"){document.getElementById("adminDashboard").classList.remove("hidden");}
      else{document.getElementById("studentDashboard").classList.remove("hidden"); loadSubjects();}
    }else{
      document.getElementById("errorMsg").innerText="Invalid username or password!";
    }
  }

  function logout(){ location.reload(); }

  function loadSubjects(){
    let sel=document.getElementById("subjectSelect"); sel.innerHTML="";
    for(let sub in subjects){ let opt=document.createElement("option"); opt.value=sub; opt.text=sub; sel.add(opt);}
  }

  function startExam(){
    currentSubject=document.getElementById("subjectSelect").value;
    let qs=subjects[currentSubject]; if(qs.length===0){alert("No questions yet!"); return;}
    document.getElementById("dashboard").classList.add("hidden");
    document.getElementById("examArea").classList.remove("hidden");
    document.getElementById("examSubject").innerText=currentSubject;
    let form=document.getElementById("examForm"); form.innerHTML="";
    qs.forEach((q,i)=>{ 
      form.innerHTML+=`<div class='question'><p>${i+1}. ${q.q}</p>
      <label><input type="radio" name="q${i}" value="A"> ${q.a}</label><br>
      <label><input type="radio" name="q${i}" value="B"> ${q.b}</label><br>
      <label><input type="radio" name="q${i}" value="C"> ${q.c}</label><br>
      <label><input type="radio" name="q${i}" value="D"> ${q.d}</label></div>`;
    });
    timeLeft=60; updateTimer(); timer=setInterval(updateTimer,1000);
  }

  function updateTimer(){
    document.getElementById("timer").innerText=timeLeft+"s";
    if(timeLeft<=0){ clearInterval(timer); submitExam(); }
    timeLeft--;
  }

  function submitExam(){
    clearInterval(timer);
    let qs=subjects[currentSubject]; let form=document.getElementById("examForm");
    let score=0; qs.forEach((q,i)=>{ let ans=form[`q${i}`].value; if(ans===q.correct) score++; });
    scores.push({student:currentUser,subject:currentSubject,score:score});
    localStorage.setItem("scores",JSON.stringify(scores));
    alert("Exam submitted!"); logout();
  }

  // Admin panel
  function showAdminPanel(){
    document.getElementById("adminPanel").classList.remove("hidden");
    loadAdminSubjects(); showQuestions();
  }

  function addSubject(){
    let sub=prompt("Enter subject name:"); if(!sub) return;
    if(!subjects[sub]){subjects[sub]=[]; localStorage.setItem("subjects",JSON.stringify(subjects)); loadAdminSubjects();}
  }
  function deleteSubject(){
    let sel=document.getElementById("adminSubjectSelect").value;
    if(confirm("Delete "+sel+"?")){delete subjects[sel]; localStorage.setItem("subjects",JSON.stringify(subjects)); loadAdminSubjects();}
  }

  function loadAdminSubjects(){
    let sel=document.getElementById("adminSubjectSelect"); sel.innerHTML="";
    for(let sub in subjects){ let opt=document.createElement("option"); opt.value=sub; opt.text=sub; sel.add(opt);}
  }

  function addQuestion(){
    let sub=document.getElementById("adminSubjectSelect").value;
    let q={q:document.getElementById("questionText").value,a:document.getElementById("optA").value,
           b:document.getElementById("optB").value,c:document.getElementById("optC").value,
           d:document.getElementById("optD").value,correct:document.getElementById("correct").value};
    subjects[sub].push(q); localStorage.setItem("subjects",JSON.stringify(subjects));
    showQuestions(); alert("Question saved!");
  }

  function showQuestions(){
    let sub=document.getElementById("adminSubjectSelect").value;
    let list=document.getElementById("questionList"); list.innerHTML="";
    if(!sub) return;
    subjects[sub].forEach((q,i)=>{ 
      list.innerHTML+=`<div class='question'><b>${i+1}. ${q.q}</b>
      <br>A: ${q.a} | B: ${q.b} | C: ${q.c} | D: ${q.d} 
      <br>Correct: ${q.correct}</div>`; 
    });
  }

  function showScores(){
    document.getElementById("scoreBoard").classList.remove("hidden");
    let tb=document.getElementById("scoreTable"); tb.innerHTML="";
    scores.forEach(s=>{ tb.innerHTML+=`<tr><td>${s.student}</td><td>${s.subject}</td><td>${s.score}</td></tr>`; });
  }
</script>
</body>
</html>
